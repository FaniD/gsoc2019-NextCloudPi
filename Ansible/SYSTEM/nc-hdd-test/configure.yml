#

---
- hosts: local
  connection: local
  vars:
    local_swap:  "{{ lookup('env','SWAPFILE') }}"
  tasks:
    - shell: lsblk -ln | grep "^sd[[:alpha:]].*disk" | awk '{ print $1 }'
      register: drives
    - shell: echo "no drives detected. Abort"
      when: "{{ drives.stdout_lines|length == 0}}"
    - meta: end_play
      when: "{{ drives.stdout_lines|length == 0}}"
    - shell: local type="" && smartctl -d test /dev/{{ item }} &>/dev/null || { smartctl -d sat -i /dev/{{ item }} $>/dev/null || { echo "couldnt detect device type"; return 1; } type="-d sat" }
      with_items:
        - "{{ drives.stdout_lines }}"


     

